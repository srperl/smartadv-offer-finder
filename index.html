<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SmartADV Offer Finder</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      padding: 20px;
    }
    h1 {
      color: #333;
    }
    .filters {
      margin-bottom: 20px;
    }
    select, button {
      padding: 8px;
      margin-right: 10px;
    }
    .offer {
      background-color: white;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      display: flex;
      gap: 15px;
    }
    .offer img {
      width: 120px;
      height: auto;
      border-radius: 4px;
    }
    .offer-info {
      flex: 1;
    }
    .offer h3 {
      margin: 0 0 10px;
      color: #222;
    }
    .offer p {
      margin: 5px 0;
    }
    .offer a {
      display: inline-block;
      margin-top: 10px;
      color: #fff;
      background: #0073e6;
      padding: 8px 12px;
      text-decoration: none;
      border-radius: 4px;
    }
    .offer a:hover {
      background: #005bb5;
    }
  </style>
</head>
<body>
  <h1>SmartADV Offer Finder</h1>
  <div class="filters">
    <select id="categorySelect">
      <option value="">All Categories</option>
      <option value="Health">Health</option>
      <option value="Beauty">Beauty</option>
      <option value="Diet">Diet</option>
      <option value="Ecommerce">Ecommerce</option>
    </select>
    <select id="channelSelect">
      <option value="">All Channels</option>
      <option value="Banner">Banner</option>
      <option value="Native">Native</option>
      <option value="Social">Social</option>
      <option value="Push">Push</option>
    </select>
    <select id="countrySelect">
      <option value="">All Countries</option>
      <option value="US">US</option>
      <option value="UK">UK</option>
      <option value="AU">AU</option>
      <option value="CA">CA</option>
    </select>
    <button onclick="loadOffers()">Search</button>
  </div>
  <div id="offers">Loading offers...</div>

  <script>
    const apiKey = 'patnPgIMAMI9ZXwum.7860eff03b9c59d78ad536532edb41bd347c6900e8f9724681452fd68757097a';
    const baseId = 'app12gesbScGlSR9r';
    const tableName = 'Imported table';

    function loadOffers() {
      const category = document.getElementById('categorySelect').value;
      const channel = document.getElementById('channelSelect').value;
      const country = document.getElementById('countrySelect').value;

      let formulaParts = ['{test subset}=1'];
      if (category) formulaParts.push(`FIND(\"${category}\", ARRAYJOIN({Category}))`);
      if (channel) formulaParts.push(`FIND(\"${channel}\", ARRAYJOIN({Channels}))`);
      if (country) formulaParts.push(`FIND(\"${country}\", ARRAYJOIN({Countries}))`);
      const filterFormula = `AND(${formulaParts.join(',')})`;

      fetch(`https://api.airtable.com/v0/${baseId}/${tableName}?maxRecords=15&filterByFormula=${encodeURIComponent(filterFormula)}`, {
        headers: {
          Authorization: `Bearer ${apiKey}`,
        },
      })
        .then(res => res.json())
        .then(data => {
          const container = document.getElementById('offers');
          if (!data.records || data.records.length === 0) {
            container.innerHTML = "<p>No matching offers found.</p>";
            return;
          }
          container.innerHTML = data.records.map(record => {
            const f = record.fields;
            return `
              <div class="offer">
                <img src="${f['thumbnail url'] || ''}" alt="Thumbnail">
                <div class="offer-info">
                  <h3>${f.Name || 'Unnamed Offer'}</h3>
                  <p><strong>Highlight:</strong> ${f.Description || 'No description'}</p>
                  <p><strong>Category:</strong> ${f.Category?.join(', ') || 'N/A'}</p>
                  <p><strong>Payout:</strong> $${f.Payout || 'N/A'}</p>
                  <p><strong>GEOs:</strong> ${f.Countries?.join(', ') || 'N/A'}</p>
                  <a href="${f['Portal Link']}" target="_blank">Apply Now</a>
                </div>
              </div>
            `;
          }).join('');
        })
        .catch(err => {
          document.getElementById('offers').innerHTML = "⚠️ Error loading offers.";
          console.error(err);
        });
    }

    loadOffers();
  </script>
</body>
</html>
